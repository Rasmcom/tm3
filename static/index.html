<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ملف شواهد الأداء الوظيفي للمعلم</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            padding-right: 70px; /* Space for sidebar */
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Styles */
        header {
            background-color: #333;
            padding: 15px 0;
            position: relative;
            width: 100%;
        }
        
        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            margin: 0 auto;
        }
        
        .logo {
            width: 60px;
            height: auto;
            margin-left: 15px;
        }
        
        .site-title {
            color: white;
            font-size: 20px;
            font-weight: 700;
        }
        
        .teacher-name {
            color: #4CAF50;
            font-size: 20px;
            font-weight: 700;
            margin-right: 10px;
        }
        
        .header-info {
            color: white;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            width: 100%;
        }
        
        .header-info-row {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .header-info p {
            margin: 0;
        }
        
        /* Layout */
        .main-layout {
            display: flex;
            min-height: calc(100vh - 200px);
        }
        
        /* Sidebar Navigation */
        .sidebar {
            width: 70px;
            background-color: #333;
            position: fixed;
            top: 0;
            right: 0;
            height: 100%;
            z-index: 100;
            padding-top: 180px;
        }
        
        .nav-list {
            list-style: none;
            padding: 0;
        }
        
        .nav-item {
            position: relative;
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 0;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            background-color: rgba(76, 175, 80, 0.2);
        }
        
        .nav-link.active {
            background-color: #4CAF50;
        }
        
        .nav-icon {
            font-size: 20px;
            text-align: center;
        }
        
        .nav-text {
            position: absolute;
            right: 70px;
            top: 0;
            background-color: #333;
            padding: 8px 15px 8px 15px;
            border-radius: 8px 0 0 8px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: -2px 0 10px rgba(0,0,0,0.2);
            height: 100%;
            display: flex;
            align-items: center;
            margin: 0;
            font-weight: bold;
        }
        
        .nav-link:hover .nav-text {
            opacity: 1;
            visibility: visible;
            right: 50px;
            background: linear-gradient(to right, #2196F3, #4CAF50);
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        /* Content Area */
        .content-area {
            flex: 1;
            padding: 20px;
            width: 100%;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            min-height: 400px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2196F3;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Introduction Page */
        .intro-section {
            margin-bottom: 40px;
            position: relative;
            padding: 25px;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .intro-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, #2196F3, #4CAF50);
        }
        
        .intro-section h2 {
            color: #2196F3;
            margin-bottom: 20px;
            font-size: 24px;
            position: relative;
            padding-bottom: 10px;
        }
        
        .intro-section h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 60px;
            height: 3px;
            background-color: #4CAF50;
        }
        
        .intro-section p {
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 16px;
            text-align: justify;
        }
        
        /* Leaders Words */
        .leaders-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        
        .leader-card {
            width: 100%;
            max-width: 350px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            background-color: #fff;
            position: relative;
        }
        
        .leader-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .leader-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, #2196F3, #4CAF50);
        }
        
        .leader-content {
            padding: 20px 25px 30px;
            text-align: center;
        }
        
        .leader-content h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 18px;
            line-height: 1.4;
            position: relative;
            padding-bottom: 15px;
        }
        
        .leader-content h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 2px;
            background: linear-gradient(to right, #2196F3, #4CAF50);
        }
        
        .leader-content p {
            line-height: 1.8;
            text-align: justify;
            color: #555;
            font-size: 15px;
            position: relative;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .leader-content p::before {
            content: '\201C';
            font-size: 60px;
            position: absolute;
            top: -15px;
            right: 10px;
            color: #e0e0e0;
            font-family: serif;
        }
        
        /* Footer */
        footer {
            background-color: #333;
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-top: 30px;
        }
        
        .footer-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .footer-logo {
            width: 40px;
            height: auto;
            transition: transform 0.3s ease;
        }
        
        .footer-logo:hover {
            transform: scale(1.1);
        }
        
        .footer-link {
            color: #2196F3;
            text-decoration: none;
        }
        
        /* Error Message */
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }
        
        /* Success Message */
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-top">
                    <div class="logo-container">
                        <img src="https://via.placeholder.com/60x60/4CAF50/white?text=شعار" alt="شعار المدرسة" class="logo">
                        <div>
                            <div class="site-title">ملف شواهد الأداء الوظيفي</div>
                            <div class="teacher-name" id="teacher-name">جاري التحميل...</div>
                        </div>
                    </div>
                </div>
                <div class="header-info">
                    <div class="header-info-row">
                        <p id="teacher-school">جاري التحميل...</p>
                        <p id="teacher-level">جاري التحميل...</p>
                        <p id="teacher-subject">جاري التحميل...</p>
                    </div>
                    <div class="header-info-row">
                        <p id="teacher-phone">جاري التحميل...</p>
                        <p id="teacher-email">جاري التحميل...</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-tab="intro">
                        <i class="nav-icon fas fa-home"></i>
                        <span class="nav-text">المقدمة</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="leaders">
                        <i class="nav-icon fas fa-users"></i>
                        <span class="nav-text">كلمات القادة</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="cv">
                        <i class="nav-icon fas fa-user"></i>
                        <span class="nav-text">السيرة الذاتية</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="certificates">
                        <i class="nav-icon fas fa-certificate"></i>
                        <span class="nav-text">الشهادات</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="courses">
                        <i class="nav-icon fas fa-graduation-cap"></i>
                        <span class="nav-text">الدورات</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Introduction Tab -->
            <div id="intro" class="tab-content active">
                <div class="loading" id="intro-loading">
                    <div class="spinner"></div>
                </div>
                <div id="intro-content" style="display: none;">
                    <!-- سيتم تحميل المحتوى من قاعدة البيانات -->
                </div>
            </div>

            <!-- Leaders Words Tab -->
            <div id="leaders" class="tab-content">
                <div class="loading" id="leaders-loading">
                    <div class="spinner"></div>
                </div>
                <div id="leaders-content" style="display: none;">
                    <div class="leaders-header">
                        <h2>كلمات القادة</h2>
                    </div>
                    <div class="leaders-container" id="leaders-container">
                        <!-- سيتم تحميل كلمات القادة من قاعدة البيانات -->
                    </div>
                </div>
            </div>

            <!-- CV Tab -->
            <div id="cv" class="tab-content">
                <h2>السيرة الذاتية</h2>
                <p>هذا القسم سيحتوي على السيرة الذاتية التفصيلية.</p>
            </div>

            <!-- Certificates Tab -->
            <div id="certificates" class="tab-content">
                <div class="loading" id="certificates-loading">
                    <div class="spinner"></div>
                </div>
                <div id="certificates-content" style="display: none;">
                    <h2>الشهادات</h2>
                    <div id="certificates-container">
                        <!-- سيتم تحميل الشهادات من قاعدة البيانات -->
                    </div>
                </div>
            </div>

            <!-- Courses Tab -->
            <div id="courses" class="tab-content">
                <div class="loading" id="courses-loading">
                    <div class="spinner"></div>
                </div>
                <div id="courses-content" style="display: none;">
                    <h2>الدورات التدريبية</h2>
                    <div id="courses-container">
                        <!-- سيتم تحميل الدورات من قاعدة البيانات -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <img src="https://via.placeholder.com/40x40/4CAF50/white?text=شعار" alt="شعار المدرسة" class="footer-logo">
                <p>&copy; 2024 ملف شواهد الأداء الوظيفي للمعلم. جميع الحقوق محفوظة.</p>
                <a href="#" class="footer-link">الموقع الرسمي للمدرسة</a>
            </div>
        </div>
    </footer>

    <script>
        // API Base URL
        const API_BASE = '/api';

        // عناصر DOM
        const navLinks = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');

        // تبديل التبويبات
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                // إزالة الفئة النشطة من جميع الروابط والتبويبات
                navLinks.forEach(l => l.classList.remove('active'));
                tabContents.forEach(tab => tab.classList.remove('active'));
                
                // إضافة الفئة النشطة للرابط المحدد
                link.classList.add('active');
                
                // إظهار التبويب المطلوب
                const tabId = link.getAttribute('data-tab');
                const targetTab = document.getElementById(tabId);
                if (targetTab) {
                    targetTab.classList.add('active');
                    
                    // تحميل البيانات حسب التبويب
                    loadTabData(tabId);
                }
            });
        });

        // تحميل البيانات حسب التبويب
        function loadTabData(tabId) {
            switch(tabId) {
                case 'intro':
                    loadIntroData();
                    break;
                case 'leaders':
                    loadLeadersData();
                    break;
                case 'certificates':
                    loadCertificatesData();
                    break;
                case 'courses':
                    loadCoursesData();
                    break;
            }
        }

        // تحميل معلومات المعلم الأساسية
        async function loadTeacherInfo() {
            try {
                const response = await fetch(`${API_BASE}/teacher-info`);
                if (response.ok) {
                    const teacher = await response.json();
                    
                    document.getElementById('teacher-name').textContent = teacher.name || 'غير محدد';
                    document.getElementById('teacher-school').textContent = teacher.school || 'غير محدد';
                    document.getElementById('teacher-level').textContent = teacher.education_level || 'غير محدد';
                    document.getElementById('teacher-subject').textContent = teacher.subject || 'غير محدد';
                    document.getElementById('teacher-phone').textContent = teacher.phone || 'غير محدد';
                    document.getElementById('teacher-email').textContent = teacher.email || 'غير محدد';
                } else {
                    console.error('فشل في تحميل معلومات المعلم');
                }
            } catch (error) {
                console.error('خطأ في تحميل معلومات المعلم:', error);
            }
        }

        // تحميل بيانات المقدمة
        async function loadIntroData() {
            const loading = document.getElementById('intro-loading');
            const content = document.getElementById('intro-content');
            
            try {
                loading.style.display = 'flex';
                content.style.display = 'none';
                
                const [introResponse, visionResponse, missionResponse] = await Promise.all([
                    fetch(`${API_BASE}/sections/intro`),
                    fetch(`${API_BASE}/sections/vision`),
                    fetch(`${API_BASE}/sections/mission`)
                ]);
                
                const intro = introResponse.ok ? await introResponse.json() : null;
                const vision = visionResponse.ok ? await visionResponse.json() : null;
                const mission = missionResponse.ok ? await missionResponse.json() : null;
                
                content.innerHTML = `
                    <div class="intro-section">
                        <h2>${intro?.title || 'مقدمة'}</h2>
                        <p>${intro?.content || 'مرحباً بكم في ملف شواهد الأداء الوظيفي.'}</p>
                    </div>
                    
                    <div class="vision-mission-container">
                        <div class="vision-box">
                            <h2><i class="fas fa-eye"></i>${vision?.title || 'الرؤية'}</h2>
                            <p>${vision?.content || 'رؤية المعلم للمستقبل.'}</p>
                        </div>
                        
                        <div class="mission-box">
                            <h2><i class="fas fa-bullseye"></i>${mission?.title || 'الرسالة'}</h2>
                            <p>${mission?.content || 'رسالة المعلم في التعليم.'}</p>
                        </div>
                    </div>
                `;
                
                loading.style.display = 'none';
                content.style.display = 'block';
                
            } catch (error) {
                console.error('خطأ في تحميل بيانات المقدمة:', error);
                content.innerHTML = '<div class="error-message">حدث خطأ في تحميل البيانات</div>';
                loading.style.display = 'none';
                content.style.display = 'block';
            }
        }

        // تحميل كلمات القادة
        async function loadLeadersData() {
            const loading = document.getElementById('leaders-loading');
            const content = document.getElementById('leaders-content');
            const container = document.getElementById('leaders-container');
            
            try {
                loading.style.display = 'flex';
                content.style.display = 'none';
                
                const response = await fetch(`${API_BASE}/leader-words`);
                if (response.ok) {
                    const leaders = await response.json();
                    
                    container.innerHTML = leaders.map(leader => `
                        <div class="leader-card">
                            <div class="leader-content">
                                <h3>${leader.leader_name}</h3>
                                <p>${leader.message}</p>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<div class="error-message">لم يتم العثور على كلمات القادة</div>';
                }
                
                loading.style.display = 'none';
                content.style.display = 'block';
                
            } catch (error) {
                console.error('خطأ في تحميل كلمات القادة:', error);
                container.innerHTML = '<div class="error-message">حدث خطأ في تحميل البيانات</div>';
                loading.style.display = 'none';
                content.style.display = 'block';
            }
        }

        // تحميل الشهادات
        async function loadCertificatesData() {
            const loading = document.getElementById('certificates-loading');
            const content = document.getElementById('certificates-content');
            const container = document.getElementById('certificates-container');
            
            try {
                loading.style.display = 'flex';
                content.style.display = 'none';
                
                const response = await fetch(`${API_BASE}/certificates`);
                if (response.ok) {
                    const certificates = await response.json();
                    
                    if (certificates.length > 0) {
                        container.innerHTML = certificates.map(cert => `
                            <div class="certificate-item" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
                                <h3>${cert.title}</h3>
                                <p><strong>الجهة المانحة:</strong> ${cert.issuer || 'غير محدد'}</p>
                                <p><strong>تاريخ الإصدار:</strong> ${cert.date_issued || 'غير محدد'}</p>
                                ${cert.description ? `<p><strong>الوصف:</strong> ${cert.description}</p>` : ''}
                                ${cert.certificate_file ? `<p><a href="${cert.certificate_file}" target="_blank">عرض الشهادة</a></p>` : ''}
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = '<p>لا توجد شهادات مضافة بعد.</p>';
                    }
                } else {
                    container.innerHTML = '<div class="error-message">لم يتم العثور على الشهادات</div>';
                }
                
                loading.style.display = 'none';
                content.style.display = 'block';
                
            } catch (error) {
                console.error('خطأ في تحميل الشهادات:', error);
                container.innerHTML = '<div class="error-message">حدث خطأ في تحميل البيانات</div>';
                loading.style.display = 'none';
                content.style.display = 'block';
            }
        }

        // تحميل الدورات
        async function loadCoursesData() {
            const loading = document.getElementById('courses-loading');
            const content = document.getElementById('courses-content');
            const container = document.getElementById('courses-container');
            
            try {
                loading.style.display = 'flex';
                content.style.display = 'none';
                
                const response = await fetch(`${API_BASE}/courses`);
                if (response.ok) {
                    const courses = await response.json();
                    
                    if (courses.length > 0) {
                        container.innerHTML = courses.map(course => `
                            <div class="course-item" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
                                <h3>${course.title}</h3>
                                <p><strong>مقدم الدورة:</strong> ${course.provider || 'غير محدد'}</p>
                                <p><strong>تاريخ الإكمال:</strong> ${course.date_completed || 'غير محدد'}</p>
                                ${course.duration_hours ? `<p><strong>عدد الساعات:</strong> ${course.duration_hours} ساعة</p>` : ''}
                                ${course.description ? `<p><strong>الوصف:</strong> ${course.description}</p>` : ''}
                                ${course.certificate_file ? `<p><a href="${course.certificate_file}" target="_blank">عرض الشهادة</a></p>` : ''}
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = '<p>لا توجد دورات مضافة بعد.</p>';
                    }
                } else {
                    container.innerHTML = '<div class="error-message">لم يتم العثور على الدورات</div>';
                }
                
                loading.style.display = 'none';
                content.style.display = 'block';
                
            } catch (error) {
                console.error('خطأ في تحميل الدورات:', error);
                container.innerHTML = '<div class="error-message">حدث خطأ في تحميل البيانات</div>';
                loading.style.display = 'none';
                content.style.display = 'block';
            }
        }

        // تهيئة البيانات عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', async () => {
            // تحميل معلومات المعلم
            await loadTeacherInfo();
            
            // تحميل بيانات التبويب الأول (المقدمة)
            loadIntroData();
            
            // إضافة البيانات التجريبية إذا لم تكن موجودة
            try {
                await fetch(`${API_BASE}/init-sample-data`, { method: 'POST' });
            } catch (error) {
                console.log('البيانات التجريبية موجودة بالفعل أو حدث خطأ:', error);
            }
        });
    </script>
</body>
</html>

